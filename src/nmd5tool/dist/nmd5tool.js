!function(e){var t={};function i(s){if(t[s])return t[s].exports;var l=t[s]={i:s,l:!1,exports:{}};return e[s].call(l.exports,l,l.exports,i),l.l=!0,l.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)i.d(s,l,function(t){return e[t]}.bind(null,l));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t,i){const s=i(4);e.exports.log=new s,e.exports.fileutil=i(5),e.exports.stringutil=i(7),e.exports.collectionutil=i(8),e.exports.exit=function(e){process.exit(e)}},function(e,t,i){"use strict";const s=i(0),l=i(1),r=i(2),{MD5Result:n,MD5ResultMap:o,MD5ResultDiff:u,MD5Lib:a}=i(9);var c=new a,f=null,d=null;!async function(){var e=Date.now();!function(){for(var e of(process.argv.length<3&&(r.log.error("Not enough args."),r.exit(1)),process.argv.values()))"test"==(e=e.toLowerCase())?(r.log.log("Test mode enabled."),!0,r.log.debugMode=!0):"debug"==e?(r.log.log("Debug mode enabled."),r.log.debugMode=!0):"create"!=e&&"createforeach"!=e&&"verify"!=e&&"verifyall"!=e||(d=e);null==d&&(r.log.error("Execution mode was not specified."),r.exit(1)),r.log.debug("Mode: "+e),f=process.argv[process.argv.length-1],r.fileutil.isDir(f)||(r.log.error("Directory does not exist: "+f),r.exit(1)),f=s.realpathSync(f),r.log.log("Working Directory: "+f)}(),"create"==d?c.createChecksumFile(f):"createforeach"==d?function(e){var t=0,i=0,n=0;for(var o of s.readdirSync(e)){var u=e+l.sep+o;if(r.fileutil.isDir(u)){var a=c.createChecksumFile(u);t+=a.totalSize,i+=a.fileCount,n+=1}}r.log.log("Created "+n+" "+CHECKSUM_FILE_NAME+" files. Indexed "+i.toLocaleString()+" files, "+r.stringutil.formatFileSizePretty(t)+".")}(f):"verify"==d?c.verifyChecksums(f):"verifyall"==d&&function(e){for(var t of r.fileutil.listFiles(e))if(-1!=t.indexOf(CHECKSUM_FILE_NAME)){var i=e+l.sep+t,s=l.dirname(i);c.verifyChecksums(s)}}(f);var t=Date.now()-e;r.log.log("Execution Time: "+r.stringutil.formatTimeHMSPretty(t)),r.exit(0)}()},function(e,t){e.exports=class{constructor(){this.debugMode=!1,this.traceMode=!1}log(e,t){if(arguments.length>2){t=[];for(var i=1;i<arguments.length;i++)t.push(arguments.at(i));console.log(e,t)}else 2==arguments.length&&console.log(e,t);console.log(e)}debug(e,t){this.debugMode&&this.log(e,t)}trace(e,t){this.traceMode&&this.log(e,t)}debugobj(){this.debugMode&&this.log("object",arguments)}traceobj(){this.debugMode&&this.log("object",arguments)}error(e,t){this.log("ERROR: "+e,t),this.debugMode&&(console.trace(),this.log(""))}}},function(e,t,i){const s=i(0),l=i(1),r=i(6);function n(e){return null!=e&&s.existsSync(e)&&s.statSync(e).isDirectory()}function o(e){return null!=e&&s.existsSync(e)&&s.statSync(e).isFile()}e.exports={isDir:n,isFile:o,isHiddenFile:function(e){return!!o&&"."==l.posix.basename(e).charAt(0)},listFiles:function e(t,i){i=null==i?"":i;var r=s.readdirSync(t),o=[];for(var u of r.values()){var a=t+l.sep+u;if(n(a)){var c=""==i?u:i+l.sep+u;o=o.concat(e(a,c))}else""==i?o.push(u):o.push(i+l.sep+u)}return o.sort(),o},md5:function(e){var t='cd "'+l.dirname(e)+'" && md5sum -b "'+l.basename(e)+'"',i=""+r.execSync(t);return i.substr(0,i.indexOf(" "))}}},function(e,t){e.exports=require("child_process")},function(e,t){e.exports.const={kilobyte:1024,megabyte:1048576,gigabyte:1073741824,terabyte:1099511627776,petabyte:0x4000000000000,millisInSecond:1e3,millisInMinute:6e4,millisInHour:36e5,millisInDay:864e5,millisInWeek:6048e5,millisInYear:31536e6},e.exports.formatFileSizePretty=function(e){var t=null,i=null;if(e>=0x4000000000000)t=0x4000000000000,i="PB";else if(e>=1099511627776)t=1099511627776,i="TB";else if(e>=1073741824)t=1073741824,i="GB";else if(e>=1048576)t=1048576,i="MB";else{if(!(e>=1024))return e.toLocaleString()+" bytes";t=1024,i="KB"}return""+(e=1*e/(1*t)).toFixed(2)+i},e.exports.formatTimeHMSPretty=function(e){var t="",i=0;return e>31536e6&&(e-=31536e6*(i=Math.floor(e/31536e6)),t+=i+"y"),e>6048e5&&(e-=6048e5*(i=Math.floor(e/6048e5)),t+=i+"w"),e>864e5&&(e-=864e5*(i=Math.floor(e/864e5)),t+=i+"d"),e>36e5&&(e-=36e5*(i=Math.floor(e/36e5)),t+=i+"h"),e>6e4&&(e-=6e4*(i=Math.floor(e/6e4)),t+=i+"m"),0==e?t+"0s":t+=(i=(e/1e3).toFixed(3))+"s"}},function(e,t){e.exports={mapBy:function(e,t){var i=new Map;if(null==e||null==t||0==e.length)return i;for(var s of e.values())null!=s&&null!=s[t]&&i.set(s[t],s);return i},getSortedKeys:function(e){var t=Object.keys(e);return t.sort((function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())})),t}}},function(e,t,i){const s=i(0),l=i(1),r=i(2);class n{constructor(e,t,i,n){if(this.fileRelativePath=e,this.fullFilePath=t,this.checksum=i,this.source=n,this.status=null,this.fileDetails=new Object,r.fileutil.isFile(t)){var o=s.statSync(t);this.fileDetails.basename=l.basename(t),this.fileDetails.size=o.size,this.fileDetails.modTimeMs=o.mtimeMs}}}class o{constructor(e){for(var t of(this.md5ResultsArray=e,this.mapByRelativePath=new Map,this.mapByChecksum=new Map,e))if(null!=t.fileRelativePath&&this.mapByRelativePath.set(t.fileRelativePath,t),null!=t.checksum){var i=this.mapByChecksum.get(key);null==i&&(i=[],this.mapByChecksum.set(key,i)),i.push(t)}}listFiles(){return this.md5ResultsArray}getFilesWithChecksum(e){return this.mapByChecksum.get(e)}getFileWithRelativePath(e){return this.mapByRelativePath.get(e)}}class u{constructor(e,t){this.oldFilesMap=new o(e),this.newFilesMap=new o(t),this.verifiedFiles=[],this.changedFiles=[],this.missingFiles=[],this.movedFiles=[],this.addedFiles=[],this.addedDuplicateFiles=[],this.performDiff()}performDiff(){for(let e of this.oldFilesMap.listFiles().values())isNewFileExists(e)?isOldFileChanged(e)?(e.status="Changed",this.changedFiles.push(e)):(e.status="Verified",this.verifiedFiles.push(e)):isOldFileMoved(e)?(e.status="Moved to "+getFirstDuplicate(e).fileRelativePath,this.movedFiles.push(e)):(e.status="Removed",this.missingFiles.push(e));for(let e of this.newFilesMap.listFiles().values())console.log("ERROR: moved file check won't work, oldfile object won't .equals(newFile)"),isFileNew(e)&&(this.movedFiles.includes(e)||(isNewFileADuplicate(e)?(e.status="Added (Duplicate)",this.addedDuplicateFiles.push(e)):(e.status="Added",this.addedFiles.push(e))))}isOldFileChanged(e){var t=this.newFilesMap.getFileWithRelativePath(e.fileRelativePath);return null!=t&&t.checksum==t.checksum}isNewFileExists(e){return null!=this.newFilesMap.getFileWithRelativePath(e.fileRelativePath)}isFileNew(e){return null!=this.oldFilesMap.getFileWithRelativePath(e.fileRelativePath)}isNewFileADuplicate(e){var t=this.oldFilesMap.getFilesWithChecksum(e.checksum);return null!=t&&t.length>0}getNewDuplicatesList(e){var t=this.newFilesMap.getFilesWithChecksum(e.checksum),i=[];if(null==t||0==t.length)for(let s of t.values())s.fileRelativePath!=e.fileRelativePath&&i.push(s);return i}getFirstDuplicate(e){getNewDuplicatesList(e);return 0==list.length?null:list.at(0)}isOldFileMoved(e){return null!=getFirstDuplicate(e).length}}e.exports={MD5Result:n,MD5ResultMap:o,MD5ResultDiff:u,MD5Lib:class{getChecksums(e){var t=[];for(var i of r.fileutil.listFiles(e).values()){var s=e+l.sep+i;if(r.fileutil.isDir(s))r.log.debug("+++ Skipping directory: "+i);else if(-1==s.indexOf("checksum.md5")){r.log.debug("+++ Processing File: "+i);var o=r.fileutil.md5(s),u=new n(i,s,o,"file system");t.push(u),r.log.debug("Created MD5Result.",u),r.log.debug("+++ Finished processing file: "+i),r.log.debug("")}else r.log.debug("+++ Skipping checksum file: "+i)}return t}readChecksumsFromFile(e){var t=e+l.sep+"checksum.md5";r.log.debug("+++ Reading checksum file: "+t);var i=""+s.readFileSync(t),o=[],u=null,a=(new n(null,null,null),0);for(var c of i.split("\n").values())if(a+=1,r.log.debug("Processing line #"+a+": "+c),0!=c.indexOf("# File: "))if(0!=c.indexOf("#")&&0!=c.trim().length){var f=c.indexOf(" ");if(-1!=f){var d=c.substr(0,f),h=c.substr(f+4),g=l.dirname(t)+l.sep+h,p=new n(h,g,d,t);if(null!=u){var m=u.indexOf("::"),v=u.substr(2).indexOf("#");p.status=u.substr(m+3,v-m-2);var F=u.substr(v+3);r.log.debugobj(F),p.fileDetails=JSON.parse(F)}u=null,r.log.debug("Parsed md5 result.",p),o.push(p)}else error("Cannot parse line #"+a+": "+c),u=null}else u=null,r.log.debug("Skipping line: '"+c+"'");else r.log.debug("Found status line: "+c),u=c;return r.log.debug("+++ Finished reading checksum file: "+t),o}createChecksumFile(e){var t=Date.now(),i=e+l.sep+"checksum.md5";process.stdout.write("Creating: "+i+" ");var n=getChecksums(e),o=(new Date).toDateString(),u=0,a="";for(var c of n.values()){var f="";null!=c.fileDetails&&(f+="# File: "+c.fileDetails.basename,null==c.status&&(c.status="Added "+o),f+=" :: "+c.status,f+=" # "+JSON.stringify(c.fileDetails)+"\n",u+=c.fileDetails.size),a+=(f+=c.checksum+" *./"+c.fileRelativePath)+"\n"}var d=r.stringutil.formatTimeHMSPretty(Date.now()-t),h="["+n.length+" files, "+r.stringutil.formatFileSizePretty(u)+", "+d+"]";return a+="# Created "+o+" "+h,process.stdout.write(h+"\n"),r.log.debugMode&&r.log.debug("Checksum File Contents: \n"+a+"\n\n"),s.writeFileSync(i,a),{totalSize:u,fileCount:n.length}}verifyChecksums(e){var t=e+l.sep+"checksum.md5";r.fileutil.isFile(t)||(r.log.error("Checksum file does not exist: "+t),r.exit(1)),log("Verifying: "+t);var i=readChecksumsFromFile(e);debug("++ Checksumming files in directory: "+e);var s=getChecksums(e);debug("++ Finished checksumming files in directory: "+e);new u(i,s)}}}}]);